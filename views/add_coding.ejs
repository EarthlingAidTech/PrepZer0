<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Coding Question</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f7fa;
    }
    
    .container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 25px;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 25px;
      border-bottom: 2px solid #eaeaea;
      padding-bottom: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #2c3e50;
    }
    
    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    textarea {
      min-height: 100px;
      font-family: monospace;
    }
    
    select {
      height: 44px;
    }
    
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    button.secondary {
      background-color: #95a5a6;
    }
    
    button.secondary:hover {
      background-color: #7f8c8d;
    }
    
    button.warning {
      background-color: #e74c3c;
    }
    
    button.warning:hover {
      background-color: #c0392b;
    }
    
    .test-case {
      background-color: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
      border-left: 4px solid #3498db;
    }
    
    .test-case .remove-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #e74c3c;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .test-case .remove-btn:hover {
      background: #c0392b;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }
    
    .checkbox-group input[type="checkbox"] {
      margin-right: 8px;
    }
    
    .checkbox-group label {
      margin-bottom: 0;
      font-weight: normal;
    }
    
    .section-title {
      margin-top: 30px;
      margin-bottom: 20px;
      color: #2c3e50;
      font-weight: bold;
      font-size: 18px;
      border-bottom: 1px solid #eaeaea;
      padding-bottom: 8px;
    }
    
    .form-row {
      display: flex;
      gap: 20px;
    }
    
    .form-col {
      flex: 1;
    }
    
    .controls {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
    }
    
    .test-case-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .test-case-header h3 {
      margin: 0;
      font-size: 16px;
    }
    
    #testCasesContainer {
      margin-top: 20px;
    }
    
    .error {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 5px;
    }
    
    .success-message {
      background-color: #d4edda;
      color: #155724;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
      display: none;
    }

    .accordion-item {
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .accordion-button {
      width: 100%;
      padding: 10px 15px;
      background: #f8f9fa;
      border: none;
      text-align: left;
      cursor: pointer;
      font-weight: bold;
    }

    .accordion-collapse {
      display: none;
      padding: 15px;
    }

    .accordion-collapse.show {
      display: block;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Add Coding Question</h1>
    
    <div id="successMessage" class="success-message">
      Question added successfully!
    </div>
    
    <form id="codingQuestionForm" action='/admin/exam/<%= examId %>/add/coding' method="POST">
      <!-- Basic Info Section -->
      <div class="section-title">Basic Information</div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="questionTile">Question Title*</label>
            <input type="text" id="questionTile" name="questionTile" required>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="maxMarks">Maximum Marks*</label>
            <input type="number" id="maxMarks" name="maxMarks" min="1" required>
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="level">Difficulty Level*</label>
            <select id="level" name="level" required>
              <option value="">Select Difficulty</option>
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="classification">Classification*</label>
            <select id="classification" name="classification" required>
              <option value="">Select Classification</option>
              <option value="Arrays">Arrays</option>
              <option value="Strings">Strings</option>
              <option value="Linked Lists">Linked Lists</option>
              <option value="Stacks">Stacks</option>
              <option value="Queues">Queues</option>
              <option value="Trees">Trees</option>
              <option value="Graphs">Graphs</option>
              <option value="Recursion">Recursion</option>
              <option value="Dynamic Programming">Dynamic Programming</option>
              <option value="Sorting">Sorting</option>
              <option value="Searching">Searching</option>
              <option value="Hashing">Hashing</option>
              <option value="Greedy Algorithms">Greedy Algorithms</option>
              <option value="Backtracking">Backtracking</option>
              <option value="Math">Math</option>
              <option value="Bit Manipulation">Bit Manipulation</option>
              <option value="Matrix">Matrix</option>
              <option value="SQL">SQL</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- Question Content Section -->
      <div class="section-title">Question Content</div>
      
      <div class="form-group">
        <label for="questiontext">Question Text*</label>
        <textarea id="questiontext" name="questiontext" required></textarea>
      </div>
      
      <div class="form-group">
        <label for="constraits">Constraints</label>
        <textarea id="constraits" name="constraits"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="inputFormat">Input Format</label>
            <textarea id="inputFormat" name="inputFormat"></textarea>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="outputFormat">Output Format</label>
            <textarea id="outputFormat" name="outputFormat"></textarea>
          </div>
        </div>
      </div>
      
      <!-- Examples Section -->
      <div class="section-title">Sample Examples</div>
      
      <div class="form-row">
        <div class="form-col">
          <div class="form-group">
            <label for="sampleInput">Sample Input*</label>
            <textarea id="sampleInput" name="sampleInput" required></textarea>
          </div>
        </div>
        <div class="form-col">
          <div class="form-group">
            <label for="sampleOutput">Sample Output*</label>
            <textarea id="sampleOutput" name="sampleOutput" required></textarea>
          </div>
        </div>
      </div>
      
      <!-- Starter Code Section -->
      <div class="section-title">Starter Code</div>
      
      <div class="form-group">
        <label for="solutionTemplate">Default Solution Template* (Primary language)</label>
        <textarea id="solutionTemplate" name="solutionTemplate" required></textarea>
      </div>
      
      <!-- Language-specific starter code accordion -->
      <div class="accordion" id="starterCodeAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button type="button" class="accordion-button collapsed" data-target="#cppCode">
              C++ Starter Code
            </button>
          </h2>
          <div id="cppCode" class="accordion-collapse">
            <div class="accordion-body">
              <div class="form-group">
                <textarea id="cppStarterCode" name="starterCode_cpp" placeholder="Enter C++ starter code here"></textarea>
              </div>
            </div>
          </div>
        </div>
        
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button type="button" class="accordion-button collapsed" data-target="#cCode">
              C Starter Code
            </button>
          </h2>
          <div id="cCode" class="accordion-collapse">
            <div class="accordion-body">
              <div class="form-group">
                <textarea id="cStarterCode" name="starterCode_c" placeholder="Enter C starter code here"></textarea>
              </div>
            </div>
          </div>
        </div>
        
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button type="button" class="accordion-button collapsed" data-target="#javaCode">
              Java Starter Code
            </button>
          </h2>
          <div id="javaCode" class="accordion-collapse">
            <div class="accordion-body">
              <div class="form-group">
                <textarea id="javaStarterCode" name="starterCode_java" placeholder="Enter Java starter code here"></textarea>
              </div>
            </div>
          </div>
        </div>
        
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button type="button" class="accordion-button collapsed" data-target="#pythonCode">
              Python Starter Code
            </button>
          </h2>
          <div id="pythonCode" class="accordion-collapse">
            <div class="accordion-body">
              <div class="form-group">
                <textarea id="pythonStarterCode" name="starterCode_python" placeholder="Enter Python starter code here"></textarea>
              </div>
            </div>
          </div>
        </div>
        
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button type="button" class="accordion-button collapsed" data-target="#csharpCode">
              C# Starter Code
            </button>
          </h2>
          <div id="csharpCode" class="accordion-collapse">
            <div class="accordion-body">
              <div class="form-group">
                <textarea id="csharpStarterCode" name="starterCode_csharp" placeholder="Enter C# starter code here"></textarea>
              </div>
            </div>
          </div>
        </div>
        
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button type="button" class="accordion-button collapsed" data-target="#jsCode">
              JavaScript Starter Code
            </button>
          </h2>
          <div id="jsCode" class="accordion-collapse">
            <div class="accordion-body">
              <div class="form-group">
                <textarea id="jsStarterCode" name="starterCode_javascript" placeholder="Enter JavaScript starter code here"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Test Cases Section -->
      <div class="section-title">Test Cases</div>
      <button type="button" id="addTestCase" class="secondary">Add Test Case</button>
      
      <div id="testCasesContainer">
        <!-- Test cases will be added here dynamically -->
      </div>
      
      <!-- Form Controls -->
      <div class="controls">
        <button type="button" id="clearForm" class="warning">Clear Form</button>
        <button type="submit" id="submitBtn">Submit Question</button>
      </div>
    </form>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let testCaseCount = 0;
      const testCasesContainer = document.getElementById('testCasesContainer');
      const addTestCaseBtn = document.getElementById('addTestCase');
      const clearFormBtn = document.getElementById('clearForm');
      const form = document.getElementById('codingQuestionForm');
      const successMessage = document.getElementById('successMessage');
      const submitBtn = document.getElementById('submitBtn');
      
      // Add test case function
      function addTestCase() {
        testCaseCount++;
        
        const testCaseDiv = document.createElement('div');
        testCaseDiv.className = 'test-case';
        testCaseDiv.setAttribute('data-id', testCaseCount);
        
        testCaseDiv.innerHTML = `
          <div class="test-case-header">
            <h3>Test Case #${testCaseCount}</h3>
            <button type="button" class="remove-btn" onclick="removeTestCase(${testCaseCount})">×</button>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="testInput${testCaseCount}">Input*</label>
                <textarea id="testInput${testCaseCount}" name="testCases[${testCaseCount-1}][input]" required></textarea>
              </div>
            </div>
            <div class="form-col">
              <div class="form-group">
                <label for="expectedOutput${testCaseCount}">Expected Output*</label>
                <textarea id="expectedOutput${testCaseCount}" name="testCases[${testCaseCount-1}][expectedOutput]" required></textarea>
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <div class="form-group">
                <label for="timeout${testCaseCount}">Timeout (seconds)</label>
                <input type="number" id="timeout${testCaseCount}" name="testCases[${testCaseCount-1}][timeout]" value="2" min="1" max="30">
              </div>
            </div>
            <div class="form-col">
              <div class="form-group">
                <label for="memoryLimit${testCaseCount}">Memory Limit (MB)</label>
                <input type="number" id="memoryLimit${testCaseCount}" name="testCases[${testCaseCount-1}][memoryLimit]" value="256" min="64" max="1024">
              </div>
            </div>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="isPublic${testCaseCount}" name="testCases[${testCaseCount-1}][isPublic]" value="true">
            <label for="isPublic${testCaseCount}">Make this test case visible to students</label>
          </div>
        `;
        
        testCasesContainer.appendChild(testCaseDiv);
      }
      
      // Remove test case function
      window.removeTestCase = function(id) {
        const testCase = document.querySelector(`.test-case[data-id="${id}"]`);
        if (testCase) {
          testCase.remove();
          // Update remaining test case indices
          updateTestCaseIndices();
        }
      }
      
      // Update test case indices after removal
      function updateTestCaseIndices() {
        const testCases = testCasesContainer.querySelectorAll('.test-case');
        testCases.forEach((testCase, index) => {
          const inputs = testCase.querySelectorAll('input, textarea');
          inputs.forEach(input => {
            const name = input.getAttribute('name');
            if (name && name.includes('testCases[')) {
              const newName = name.replace(/testCases\[\d+\]/, `testCases[${index}]`);
              input.setAttribute('name', newName);
            }
          });
          
          const header = testCase.querySelector('.test-case-header h3');
          if (header) {
            header.textContent = `Test Case #${index + 1}`;
          }
        });
      }
      
      // Add first test case by default
      addTestCase();
      
      // Add test case button click event
      addTestCaseBtn.addEventListener('click', addTestCase);
      
      // Clear form button click event
      clearFormBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to clear all form data?')) {
          form.reset();
          testCasesContainer.innerHTML = '';
          testCaseCount = 0;
          addTestCase(); // Add one default test case after clearing
        }
      });
      
      // Handle accordion toggling
      document.querySelectorAll('.accordion-button').forEach(button => {
        button.addEventListener('click', function() {
          const target = document.querySelector(this.getAttribute('data-target'));
          if (target) {
            const isOpen = target.classList.contains('show');
            
            // Close all accordions
            document.querySelectorAll('.accordion-collapse').forEach(collapse => {
              collapse.classList.remove('show');
            });
            
            // Open clicked accordion if it wasn't already open
            if (!isOpen) {
              target.classList.add('show');
            }
          }
        });
      });
      
      // Form submission - Let the form submit normally to the backend
      form.addEventListener('submit', function(e) {
        // Show loading state
        submitBtn.textContent = 'Submitting...';
        submitBtn.disabled = true;
        form.classList.add('loading');
        
        // Validate required fields
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            isValid = false;
            e.preventDefault();
            
            // Add error message if not already present
            let errorMsgElement = field.nextElementSibling;
            if (!errorMsgElement || !errorMsgElement.classList.contains('error')) {
              errorMsgElement = document.createElement('div');
              errorMsgElement.className = 'error';
              errorMsgElement.textContent = 'This field is required';
              field.parentNode.insertBefore(errorMsgElement, field.nextSibling);
            }
          } else {
            // Remove error message if field is valid
            const errorMsg = field.nextElementSibling;
            if (errorMsg && errorMsg.classList.contains('error')) {
              errorMsg.remove();
            }
          }
        });
        
        // Check if there's at least one test case
        if (testCasesContainer.children.length === 0) {
          isValid = false;
          e.preventDefault();
          alert('At least one test case is required.');
        }
        
        if (!isValid) {
          // Reset button state if validation fails
          submitBtn.textContent = 'Submit Question';
          submitBtn.disabled = false;
          form.classList.remove('loading');
        }
        
        // If valid, let the form submit normally (don't prevent default)
        // The backend will handle the redirect
      });
    });
  </script>
</body>
</html>